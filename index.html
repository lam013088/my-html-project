<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分數探險島 - 分數比較遊戲</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #fff;
        }
        
        .subtitle {
            color: #3498db;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 8px solid #f1c40f;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 15px;
            border: 3px solid #3498db;
        }
        
        .stat-item {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .stat-value {
            color: #e74c3c;
            font-size: 1.8rem;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }
        
        .fraction-display {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-bottom: 30px;
            gap: 40px;
        }
        
        .fraction-card {
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 5px solid;
            transition: transform 0.3s;
        }
        
        .fraction-card:hover {
            transform: translateY(-5px);
        }
        
        .fraction-card-1 {
            border-color: #e74c3c;
        }
        
        .fraction-card-2 {
            border-color: #3498db;
        }
        
        .fraction-number {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
        }
        
        .fraction-visual {
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
        }
        
        .circle-visual {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #f2f2f2;
            position: relative;
            overflow: hidden;
            border: 4px solid #333;
        }
        
        .circle-segment {
            position: absolute;
            width: 100%;
            height: 100%;
            clip-path: var(--clip);
            background-color: var(--color);
        }
        
        .bar-visual {
            width: 200px;
            height: 40px;
            background-color: #f2f2f2;
            border-radius: 20px;
            border: 3px solid #333;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            background-color: var(--color);
            width: var(--width);
        }
        
        .comparison-symbol {
            font-size: 4rem;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .options-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .option-btn {
            font-size: 1.8rem;
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 0 rgba(0, 0, 0, 0.2);
        }
        
        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.2);
        }
        
        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
        }
        
        .greater-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .equal-btn {
            background-color: #f1c40f;
            color: white;
        }
        
        .less-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .feedback-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 80px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.5s;
        }
        
        .correct-feedback {
            background-color: #d5f4e6;
            color: #27ae60;
            border: 4px solid #2ecc71;
        }
        
        .incorrect-feedback {
            background-color: #fadbd8;
            color: #c0392b;
            border: 4px solid #e74c3c;
        }
        
        .hidden {
            display: none;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .control-btn {
            padding: 12px 25px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            background-color: #3498db;
            color: white;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
        }
        
        .level-indicator {
            display: flex;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .level-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ddd;
        }
        
        .level-dot.active {
            background-color: #2ecc71;
        }
        
        .level-dot.completed {
            background-color: #3498db;
        }
        
        .ai-explanation {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            width: 100%;
            border-left: 6px solid #9b59b6;
        }
        
        .ai-explanation h3 {
            color: #9b59b6;
            margin-bottom: 10px;
        }
        
        .explanation-content {
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .reward-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            z-index: 100;
            animation: reward-pop 1s ease-out;
            display: none;
        }
        
        @keyframes reward-pop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .fraction-display {
                flex-direction: column;
                gap: 20px;
            }
            
            .comparison-symbol {
                transform: rotate(90deg);
                margin: 10px 0;
            }
            
            .options-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .option-btn {
                width: 220px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-island-tropical"></i> 分數探險島</h1>
        <p class="subtitle">透過圖形觀察，比較分數大小！</p>
    </div>
    
    <div class="game-container">
        <div class="stats-bar">
            <div class="stat-item">
                <div>得分</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div>連續正確</div>
                <div class="stat-value" id="streak">0</div>
            </div>
            <div class="stat-item">
                <div>等級</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-item">
                <div>已解答</div>
                <div class="stat-value" id="solved">0</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="fraction-display">
                <div class="fraction-card fraction-card-1">
                    <h3>分數 A</h3>
                    <div class="fraction-number" id="fraction1">1/2</div>
                    <div class="fraction-visual">
                        <div class="circle-visual" id="circle1"></div>
                    </div>
                    <div class="fraction-visual">
                        <div class="bar-visual" id="bar1"></div>
                    </div>
                </div>
                
                <div class="comparison-symbol">?</div>
                
                <div class="fraction-card fraction-card-2">
                    <h3>分數 B</h3>
                    <div class="fraction-number" id="fraction2">1/4</div>
                    <div class="fraction-visual">
                        <div class="circle-visual" id="circle2"></div>
                    </div>
                    <div class="fraction-visual">
                        <div class="bar-visual" id="bar2"></div>
                    </div>
                </div>
            </div>
            
            <div class="options-container">
                <button class="option-btn greater-btn" id="greater-btn">
                    <i class="fas fa-greater-than"></i> A 大於 B
                </button>
                <button class="option-btn equal-btn" id="equal-btn">
                    <i class="fas fa-equals"></i> A 等於 B
                </button>
                <button class="option-btn less-btn" id="less-btn">
                    <i class="fas fa-less-than"></i> A 小於 B
                </button>
            </div>
            
            <div class="feedback-container hidden" id="feedback-container">
                請選擇一個答案！
            </div>
        </div>
        
        <div class="level-indicator">
            <span>難度等級：</span>
            <div class="level-dot active" id="level-dot-1"></div>
            <div class="level-dot" id="level-dot-2"></div>
            <div class="level-dot" id="level-dot-3"></div>
            <div class="level-dot" id="level-dot-4"></div>
            <div class="level-dot" id="level-dot-5"></div>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="hint-btn">
                <i class="fas fa-lightbulb"></i> 我需要提示
            </button>
            <button class="control-btn" id="next-btn">
                <i class="fas fa-forward"></i> 下一題
            </button>
            <button class="control-btn" id="reset-btn">
                <i class="fas fa-redo"></i> 重新開始
            </button>
        </div>
        
        <div class="ai-explanation" id="ai-explanation">
            <h3><i class="fas fa-robot"></i> AI 小老師提示</h3>
            <div class="explanation-content" id="explanation-content">
                點擊「我需要提示」按鈕獲得解題幫助！
            </div>
        </div>
    </div>
    
    <div class="reward-animation" id="reward-animation">
        <i class="fas fa-star"></i>
    </div>

    <script>
        // 遊戲狀態變數
        let score = 0;
        let streak = 0;
        let level = 1;
        let solved = 0;
        let currentFractions = { num1: 1, den1: 2, num2: 1, den2: 4 };
        let isAnswered = false;
        
        // DOM 元素
        const scoreElement = document.getElementById('score');
        const streakElement = document.getElementById('streak');
        const levelElement = document.getElementById('level');
        const solvedElement = document.getElementById('solved');
        const fraction1Element = document.getElementById('fraction1');
        const fraction2Element = document.getElementById('fraction2');
        const circle1Element = document.getElementById('circle1');
        const circle2Element = document.getElementById('circle2');
        const bar1Element = document.getElementById('bar1');
        const bar2Element = document.getElementById('bar2');
        const feedbackContainer = document.getElementById('feedback-container');
        const explanationContent = document.getElementById('explanation-content');
        const rewardAnimation = document.getElementById('reward-animation');
        
        // 分數視覺化顏色
        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c'];
        
        // 初始化遊戲
        function initGame() {
            score = 0;
            streak = 0;
            level = 1;
            solved = 0;
            updateStats();
            generateFractions();
            setupEventListeners();
            updateLevelDots();
        }
        
        // 更新統計數據
        function updateStats() {
            scoreElement.textContent = score;
            streakElement.textContent = streak;
            levelElement.textContent = level;
            solvedElement.textContent = solved;
        }
        
        // 生成分數題目
        function generateFractions() {
            isAnswered = false;
            feedbackContainer.classList.add('hidden');
            
            // 根據等級生成不同難度的分數
            let maxDenominator = 4;
            let includeEquivalent = false;
            
            if (level === 1) {
                maxDenominator = 4;
            } else if (level === 2) {
                maxDenominator = 6;
            } else if (level === 3) {
                maxDenominator = 8;
                includeEquivalent = true;
            } else if (level >= 4) {
                maxDenominator = 10;
                includeEquivalent = true;
            }
            
            // 生成第一個分數
            const den1 = getRandomInt(2, maxDenominator);
            const num1 = getRandomInt(1, den1);
            
            // 生成第二個分數（根據等級決定是否與第一個分數相關）
            let den2, num2;
            
            if (includeEquivalent && Math.random() > 0.6) {
                // 30% 機率生成等值分數
                const equivalentFactor = getRandomInt(2, 3);
                den2 = den1 * equivalentFactor;
                num2 = num1 * equivalentFactor;
            } else {
                den2 = getRandomInt(2, maxDenominator);
                num2 = getRandomInt(1, den2);
                
                // 確保兩個分數不相同（除非是等值分數）
                if (num1/den1 === num2/den2) {
                    // 如果偶然生成等值分數，確保它們看起來不同
                    den2 = den2 + 1;
                }
            }
            
            currentFractions = { num1, den1, num2, den2 };
            
            // 更新分數顯示
            fraction1Element.textContent = `${num1}/${den1}`;
            fraction2Element.textContent = `${num2}/${den2}`;
            
            // 更新視覺化圖形
            updateVisualizations();
            
            // 重置AI解釋
            explanationContent.textContent = "點擊「我需要提示」按鈕獲得解題幫助！";
        }
        
        // 更新分數視覺化
        function updateVisualizations() {
            const { num1, den1, num2, den2 } = currentFractions;
            
            // 清除之前的視覺化
            circle1Element.innerHTML = '';
            circle2Element.innerHTML = '';
            
            // 為每個分數生成顏色
            const color1 = colors[getRandomInt(0, colors.length-1)];
            const color2 = colors[getRandomInt(0, colors.length-1)];
            
            // 創建圓形圖示
            createCircleVisual(circle1Element, num1, den1, color1);
            createCircleVisual(circle2Element, num2, den2, color2);
            
            // 創建長條圖示
            createBarVisual(bar1Element, num1, den1, color1);
            createBarVisual(bar2Element, num2, den2, color2);
        }
        
        // 創建圓形視覺化
        function createCircleVisual(container, numerator, denominator, color) {
            const angle = 360 / denominator;
            
            for (let i = 0; i < denominator; i++) {
                const segment = document.createElement('div');
                segment.className = 'circle-segment';
                
                // 設置剪裁路徑來創建扇形
                const startAngle = i * angle;
                const endAngle = (i + 1) * angle;
                
                // 創建扇形剪裁路徑
                const startX = 50 + 50 * Math.cos((startAngle - 90) * Math.PI / 180);
                const startY = 50 + 50 * Math.sin((startAngle - 90) * Math.PI / 180);
                const endX = 50 + 50 * Math.cos((endAngle - 90) * Math.PI / 180);
                const endY = 50 + 50 * Math.sin((endAngle - 90) * Math.PI / 180);
                
                const largeArcFlag = endAngle - startAngle <= 180 ? 0 : 1;
                
                const clipPath = `path('M 50 50 L ${startX} ${startY} A 50 50 0 ${largeArcFlag} 1 ${endX} ${endY} Z')`;
                
                segment.style.setProperty('--clip', clipPath);
                segment.style.setProperty('--color', i < numerator ? color : '#f2f2f2');
                
                container.appendChild(segment);
            }
        }
        
        // 創建長條視覺化
        function createBarVisual(container, numerator, denominator, color) {
            const fillPercentage = (numerator / denominator) * 100;
            container.innerHTML = `<div class="bar-fill" style="--width: ${fillPercentage}%; --color: ${color};"></div>`;
        }
        
        // 檢查答案
        function checkAnswer(comparison) {
            if (isAnswered) return;
            
            const { num1, den1, num2, den2 } = currentFractions;
            const value1 = num1 / den1;
            const value2 = num2 / den2;
            
            let correctComparison;
            if (Math.abs(value1 - value2) < 0.0001) { // 處理浮點數誤差
                correctComparison = 'equal';
            } else if (value1 > value2) {
                correctComparison = 'greater';
            } else {
                correctComparison = 'less';
            }
            
            const isCorrect = comparison === correctComparison;
            
            // 顯示反饋
            feedbackContainer.classList.remove('hidden');
            feedbackContainer.classList.remove('correct-feedback', 'incorrect-feedback');
            
            if (isCorrect) {
                // 正確答案
                feedbackContainer.textContent = getRandomCorrectFeedback();
                feedbackContainer.classList.add('correct-feedback');
                
                // 更新分數
                score += level * 10;
                streak++;
                solved++;
                
                // 顯示獎勵動畫
                showRewardAnimation();
                
                // 每解決5題提升等級
                if (solved % 5 === 0 && level < 5) {
                    level++;
                    updateLevelDots();
                }
            } else {
                // 錯誤答案
                feedbackContainer.textContent = getRandomIncorrectFeedback();
                feedbackContainer.classList.add('incorrect-feedback');
                streak = 0;
            }
            
            updateStats();
            isAnswered = true;
            
            // 顯示AI解釋
            showExplanation(correctComparison);
        }
        
        // 顯示AI解釋
        function showExplanation(correctComparison) {
            const { num1, den1, num2, den2 } = currentFractions;
            const value1 = num1 / den1;
            const value2 = num2 / den2;
            
            let explanation = "";
            
            // 根據分數類型生成解釋
            if (den1 === den2) {
                explanation = `兩個分數的分母相同（都是 ${den1}），所以只需要比較分子。${num1} ${getComparisonSymbol(correctComparison)} ${num2}，因此 ${num1}/${den1} ${getComparisonSymbol(correctComparison)} ${num2}/${den2}。`;
            } else if (num1 === num2) {
                explanation = `兩個分數的分子相同（都是 ${num1}），分母越大分數越小。${den1} ${getReverseComparisonSymbol(correctComparison)} ${den2}，因此 ${num1}/${den1} ${getComparisonSymbol(correctComparison)} ${num2}/${den2}。`;
            } else {
                // 計算小數值比較
                explanation = `${num1}/${den1} = ${value1.toFixed(2)}，${num2}/${den2} = ${value2.toFixed(2)}，所以 ${num1}/${den1} ${getComparisonSymbol(correctComparison)} ${num2}/${den2}。`;
                
                // 如果分數可以約分，添加提示
                const gcd1 = gcd(num1, den1);
                const gcd2 = gcd(num2, den2);
                
                if (gcd1 > 1 || gcd2 > 1) {
                    explanation += ` 提示：${num1}/${den1} ${gcd1 > 1 ? `可以約分為 ${num1/gcd1}/${den1/gcd1}` : ''}，${num2}/${den2} ${gcd2 > 1 ? `可以約分為 ${num2/gcd2}/${den2/gcd2}` : ''}。`;
                }
            }
            
            explanationContent.textContent = explanation;
        }
        
        // 顯示提示
        function showHint() {
            const { num1, den1, num2, den2 } = currentFractions;
            const value1 = num1 / den1;
            const value2 = num2 / den2;
            
            let hint = "";
            
            if (den1 === den2) {
                hint = `提示：當分母相同時，分子越大，分數越大。比較 ${num1} 和 ${num2} 的大小。`;
            } else if (num1 === num2) {
                hint = `提示：當分子相同時，分母越大，分數越小。比較 ${den1} 和 ${den2} 的大小。`;
            } else {
                // 提供視覺提示
                hint = `提示：觀察圖形中陰影部分的大小。你也可以把分數轉換為小數來比較：${num1}/${den1} = ${value1.toFixed(2)}，${num2}/${den2} = ${value2.toFixed(2)}。`;
            }
            
            explanationContent.textContent = hint;
        }
        
        // 顯示獎勵動畫
        function showRewardAnimation() {
            rewardAnimation.style.display = 'block';
            rewardAnimation.innerHTML = `<i class="fas fa-star"></i> +${level * 10}分!`;
            
            setTimeout(() => {
                rewardAnimation.style.display = 'none';
            }, 1500);
        }
        
        // 更新等級指示點
        function updateLevelDots() {
            for (let i = 1; i <= 5; i++) {
                const dot = document.getElementById(`level-dot-${i}`);
                if (i === level) {
                    dot.className = 'level-dot active';
                } else if (i < level) {
                    dot.className = 'level-dot completed';
                } else {
                    dot.className = 'level-dot';
                }
            }
        }
        
        // 工具函數
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }
        
        function getComparisonSymbol(comparison) {
            if (comparison === 'greater') return '>';
            if (comparison === 'less') return '<';
            return '=';
        }
        
        function getReverseComparisonSymbol(comparison) {
            if (comparison === 'greater') return '<';
            if (comparison === 'less') return '>';
            return '=';
        }
        
        function getRandomCorrectFeedback() {
            const feedbacks = [
                "太棒了！答對了！",
                "你真厲害！完全正確！",
                "答對了！你對分數的理解很棒！",
                "完美！繼續保持！",
                "聰明！分數比較難不倒你！"
            ];
            return feedbacks[getRandomInt(0, feedbacks.length - 1)];
        }
        
        function getRandomIncorrectFeedback() {
            const feedbacks = [
                "再試一次！觀察圖形可以幫助你。",
                "幾乎對了！看看AI小老師的提示。",
                "別灰心！分數比較需要多練習。",
                "再仔細看看圖形陰影部分的大小。"
            ];
            return feedbacks[getRandomInt(0, feedbacks.length - 1)];
        }
        
        // 設置事件監聽器
        function setupEventListeners() {
            document.getElementById('greater-btn').addEventListener('click', () => checkAnswer('greater'));
            document.getElementById('equal-btn').addEventListener('click', () => checkAnswer('equal'));
            document.getElementById('less-btn').addEventListener('click', () => checkAnswer('less'));
            document.getElementById('hint-btn').addEventListener('click', showHint);
            document.getElementById('next-btn').addEventListener('click', generateFractions);
            document.getElementById('reset-btn').addEventListener('click', initGame);
        }
        
        // 啟動遊戲
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>